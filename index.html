<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>绚丽的时钟效果2</title>
</head>
<body style="height: 100%;background-color: black;overflow: hidden">
<canvas id="canvas" style="display: block">
    <audio src="./music/circulation.mp3" autoplay controls preload="metadata" loop hidden></audio>
</canvas>
<script>
    digit =
            [
                [
                    [0,0,1,1,1,0,0],
                    [0,1,1,0,1,1,0],
                    [1,1,0,0,0,1,1],
                    [1,1,0,0,0,1,1],
                    [1,1,0,0,0,1,1],
                    [1,1,0,0,0,1,1],
                    [1,1,0,0,0,1,1],
                    [1,1,0,0,0,1,1],
                    [0,1,1,0,1,1,0],
                    [0,0,1,1,1,0,0]
                ],//0
                [
                    [0,0,0,1,1,0,0],
                    [0,1,1,1,1,0,0],
                    [0,0,0,1,1,0,0],
                    [0,0,0,1,1,0,0],
                    [0,0,0,1,1,0,0],
                    [0,0,0,1,1,0,0],
                    [0,0,0,1,1,0,0],
                    [0,0,0,1,1,0,0],
                    [0,0,0,1,1,0,0],
                    [1,1,1,1,1,1,1]
                ],//1
                [
                    [0,1,1,1,1,1,0],
                    [1,1,0,0,0,1,1],
                    [0,0,0,0,0,1,1],
                    [0,0,0,0,1,1,0],
                    [0,0,0,1,1,0,0],
                    [0,0,1,1,0,0,0],
                    [0,1,1,0,0,0,0],
                    [1,1,0,0,0,0,0],
                    [1,1,0,0,0,1,1],
                    [1,1,1,1,1,1,1]
                ],//2
                [
                    [1,1,1,1,1,1,1],
                    [0,0,0,0,0,1,1],
                    [0,0,0,0,1,1,0],
                    [0,0,0,1,1,0,0],
                    [0,0,1,1,1,0,0],
                    [0,0,0,0,1,1,0],
                    [0,0,0,0,0,1,1],
                    [0,0,0,0,0,1,1],
                    [1,1,0,0,0,1,1],
                    [0,1,1,1,1,1,0]
                ],//3
                [
                    [0,0,0,0,1,1,0],
                    [0,0,0,1,1,1,0],
                    [0,0,1,1,1,1,0],
                    [0,1,1,0,1,1,0],
                    [1,1,0,0,1,1,0],
                    [1,1,1,1,1,1,1],
                    [0,0,0,0,1,1,0],
                    [0,0,0,0,1,1,0],
                    [0,0,0,0,1,1,0],
                    [0,0,0,1,1,1,1]
                ],//4
                [
                    [1,1,1,1,1,1,1],
                    [1,1,0,0,0,0,0],
                    [1,1,0,0,0,0,0],
                    [1,1,1,1,1,1,0],
                    [0,0,0,0,0,1,1],
                    [0,0,0,0,0,1,1],
                    [0,0,0,0,0,1,1],
                    [0,0,0,0,0,1,1],
                    [1,1,0,0,0,1,1],
                    [0,1,1,1,1,1,0]
                ],//5
                [
                    [0,0,0,0,1,1,0],
                    [0,0,1,1,0,0,0],
                    [0,1,1,0,0,0,0],
                    [1,1,0,0,0,0,0],
                    [1,1,0,1,1,1,0],
                    [1,1,0,0,0,1,1],
                    [1,1,0,0,0,1,1],
                    [1,1,0,0,0,1,1],
                    [1,1,0,0,0,1,1],
                    [0,1,1,1,1,1,0]
                ],//6
                [
                    [1,1,1,1,1,1,1],
                    [1,1,0,0,0,1,1],
                    [0,0,0,0,1,1,0],
                    [0,0,0,0,1,1,0],
                    [0,0,0,1,1,0,0],
                    [0,0,0,1,1,0,0],
                    [0,0,1,1,0,0,0],
                    [0,0,1,1,0,0,0],
                    [0,0,1,1,0,0,0],
                    [0,0,1,1,0,0,0]
                ],//7
                [
                    [0,1,1,1,1,1,0],
                    [1,1,0,0,0,1,1],
                    [1,1,0,0,0,1,1],
                    [1,1,0,0,0,1,1],
                    [0,1,1,1,1,1,0],
                    [1,1,0,0,0,1,1],
                    [1,1,0,0,0,1,1],
                    [1,1,0,0,0,1,1],
                    [1,1,0,0,0,1,1],
                    [0,1,1,1,1,1,0]
                ],//8
                [
                    [0,1,1,1,1,1,0],
                    [1,1,0,0,0,1,1],
                    [1,1,0,0,0,1,1],
                    [1,1,0,0,0,1,1],
                    [0,1,1,1,0,1,1],
                    [0,0,0,0,0,1,1],
                    [0,0,0,0,0,1,1],
                    [0,0,0,0,1,1,0],
                    [0,0,0,1,1,0,0],
                    [0,1,1,0,0,0,0]
                ],//9
                [
                    [0,0,0,0],
                    [0,0,0,0],
                    [0,1,1,0],
                    [0,1,1,0],
                    [0,0,0,0],
                    [0,0,0,0],
                    [0,1,1,0],
                    [0,1,1,0],
                    [0,0,0,0],
                    [0,0,0,0]
                ]//:
            ];
    var WINDOW_WIDTH=1124;
    var WINDOW_HEIGHT=708; //页面的高度
    var RADIUS=8;          //每个原点的半径
    var MARGIN_TOP=70;     //时间距页面顶部的距离
    var MARGIN_LEFT=70;
    var curShowTimeSeconds=0; <!--var endTime=new Date();endTime.setTime(endTime.getTime()+3600*1000);-->
    var balls = [];
    const colors = ["#33B5E5","#0099CC","#AA66CC","#9933CC","#99CC00","#669900","#FFBB33","#FF8800","#FF4444","#CC0000"];//小球的颜色

    window.onload=function(){
        var canvas=document.getElementById("canvas");
        var context=canvas.getContext("2d");
        canvas.addEventListener('click', function(e)
        {
            location.href="index8.html";
        }, false);

        canvas.width=WINDOW_WIDTH;    //定义画布的宽度等于页面的宽度
        canvas.height=WINDOW_HEIGHT;
        curShowTimeSeconds=getCurrentShowTimeSeconds();
        //每隔40毫秒调用一次函数
        setInterval(
                function(){
                    render(context);
                    update();
                }
                ,40
        );
    };
    <!--改动区,只需改动功能函数即可，但屏幕自适应的bug未解决-->
    function getCurrentShowTimeSeconds(){
        var curTime=new Date();  //得到当前时间
        var ret=curTime.getHours()*3600+curTime.getMinutes()*60+curTime.getSeconds();//将当前时间转化为秒
        return ret;
    }
    function update(){
        var nextShowTimeSeconds=getCurrentShowTimeSeconds();
        var nextHours=parseInt(nextShowTimeSeconds/3600);
        var nextMinutes=parseInt((nextShowTimeSeconds-nextHours*3600)/60);
        var nextSeconds=nextShowTimeSeconds%60;
        var curHours=parseInt(curShowTimeSeconds/3600);
        var curMinutes=parseInt((curShowTimeSeconds-curHours*3600)/60);
        var curSeconds=curShowTimeSeconds%60;
        if( nextSeconds != curSeconds ){
            if( parseInt(curHours/10) != parseInt(nextHours/10) ){
                addBalls( MARGIN_LEFT + 0 , MARGIN_TOP , parseInt(curHours/10) );
            }
            if( parseInt(curHours%10) != parseInt(nextHours%10) ){
                addBalls( MARGIN_LEFT + 15*(RADIUS+1) , MARGIN_TOP , parseInt(curHours/10) );
            }

            if( parseInt(curMinutes/10) != parseInt(nextMinutes/10) ){
                addBalls( MARGIN_LEFT + 39*(RADIUS+1) , MARGIN_TOP , parseInt(curMinutes/10) );
            }
            if( parseInt(curMinutes%10) != parseInt(nextMinutes%10) ){
                addBalls( MARGIN_LEFT + 54*(RADIUS+1) , MARGIN_TOP , parseInt(curMinutes%10) );
            }

            if( parseInt(curSeconds/10) != parseInt(nextSeconds/10) ){
                addBalls( MARGIN_LEFT + 78*(RADIUS+1) , MARGIN_TOP , parseInt(curSeconds/10) );
            }
            if( parseInt(curSeconds%10) != parseInt(nextSeconds%10) ){
                addBalls( MARGIN_LEFT + 93*(RADIUS+1) , MARGIN_TOP , parseInt(nextSeconds%10) );
            }
            curShowTimeSeconds = nextShowTimeSeconds;
        }
        updateBalls();
        console.log(balls.length);
    }
    function updateBalls(){
        for( var i = 0 ; i < balls.length ; i ++ ){
            balls[i].x += balls[i].vx;
            balls[i].y += balls[i].vy;
            balls[i].vy += balls[i].g;
            if( balls[i].y >= WINDOW_HEIGHT-RADIUS ){
                balls[i].y = WINDOW_HEIGHT-RADIUS;
                balls[i].vy = - balls[i].vy*0.75;
            }
        }
        var cnt=0;
        for(var i=0;i<balls.length;i++)              <!--降低内存量,使程序更好的运行,对性能进行优化-->
            if(balls[i].x+RADIUS>0 && balls[i].x-RADIUS<WINDOW_WIDTH)
                balls[cnt++]=balls[i];
        while(balls.length>Math.min(300,cnt)){
            balls.pop();
        }
    }
    function addBalls( x , y , num ){
        for( var i = 0  ; i < digit[num].length ; i ++ )
            for( var j = 0  ; j < digit[num][i].length ; j ++ )
                if( digit[num][i][j] == 1 ){
                    var aBall = {
                        x:x+j*2*(RADIUS+1)+(RADIUS+1),
                        y:y+i*2*(RADIUS+1)+(RADIUS+1),
                        g:1.5+Math.random(),
                        vx:Math.pow( -1 , Math.ceil( Math.random()*1000 ) ) * 4,
                        vy:-5,
                        color: colors[ Math.floor( Math.random()*colors.length ) ]
                    };
                    balls.push( aBall )
                }
    }
    function render(cxt){
        cxt.clearRect(0,0,WINDOW_WIDTH,WINDOW_HEIGHT);//对整个屏幕进行一次刷新
        var hours=parseInt(curShowTimeSeconds/3600);  //将当前时间转化为小时
        var minutes=parseInt((curShowTimeSeconds-hours*3600)/60);
        var seconds=curShowTimeSeconds%60;
        renderDigit(MARGIN_LEFT,MARGIN_TOP,parseInt(hours/10),cxt); //依次绘制当前时间的图形
        renderDigit(MARGIN_LEFT+15*(RADIUS+1),MARGIN_TOP,parseInt(hours%10),cxt);
        renderDigit(MARGIN_LEFT+30*(RADIUS+1),MARGIN_TOP,10,cxt);
        renderDigit(MARGIN_LEFT+39*(RADIUS+1),MARGIN_TOP,parseInt(minutes/10),cxt);
        renderDigit(MARGIN_LEFT+54*(RADIUS+1),MARGIN_TOP,parseInt(minutes%10),cxt);
        renderDigit(MARGIN_LEFT+69*(RADIUS+1),MARGIN_TOP,10,cxt);
        renderDigit(MARGIN_LEFT+78*(RADIUS+1),MARGIN_TOP,parseInt(seconds/10),cxt);
        renderDigit(MARGIN_LEFT+93*(RADIUS+1),MARGIN_TOP,parseInt(seconds%10),cxt);
         //绘制小球
        for( var i = 0 ; i < balls.length ; i ++ ){
            cxt.fillStyle=balls[i].color;
            cxt.beginPath();
            cxt.arc( balls[i].x , balls[i].y , RADIUS , 0 , 2*Math.PI , true );
            cxt.closePath();
            cxt.fill();
        }
    }
   //绘制时间上的小圆点
    function renderDigit( x , y , num , cxt ){
        cxt.fillStyle = "rgb(0,200,0)";
        for( var i = 0 ; i < digit[num].length ; i ++ )
            for(var j = 0 ; j < digit[num][i].length ; j ++ )
                if( digit[num][i][j] == 1 ){
                    cxt.beginPath();
                    cxt.arc( x+j*2*(RADIUS+1)+(RADIUS+1) , y+i*2*(RADIUS+1)+(RADIUS+1) , RADIUS , 0 , 2*Math.PI )
                    cxt.closePath();
                    cxt.fill()
                }
    }
</script>
</body>
</html>
